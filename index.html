<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>mdvim - Markdown Editor with Vim</title>
  <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body>
  <div id="app">
    <header id="toolbar">
      <div class="toolbar-left">
        <span id="file-name">Untitled</span>
        <span id="file-status"></span>
      </div>
      <div class="toolbar-center">
        <button data-view="editor">Editor</button>
        <button data-view="split" class="active">Split</button>
        <button data-view="preview">Preview</button>
      </div>
      <div class="toolbar-right">
        <!-- Font size controls -->
        <div class="font-size-controls">
          <button id="btn-font-smaller" title="Smaller font">A-</button>
          <span id="font-size-display">100%</span>
          <button id="btn-font-larger" title="Larger font">A+</button>
        </div>
        
        <!-- Vim toggle -->
        <button id="btn-vim-toggle" class="active" title="Toggle Vim mode (Ctrl+`)">VIM</button>
        
        <!-- Theme selector -->
        <select id="theme-selector" title="Select theme">
          <option value="dark">Dark</option>
          <option value="light">Light</option>
          <option value="monokai">Monokai</option>
          <option value="solarized-dark">Solarized Dark</option>
          <option value="solarized-light">Solarized Light</option>
          <option value="nord">Nord</option>
          <option value="dracula">Dracula</option>
          <option value="github-dark">GitHub Dark</option>
          <option value="github-light">GitHub Light</option>
        </select>
      </div>
    </header>

    <main id="main-content">
      <!-- Vertical Tabs (Project mode) -->
      <div id="vertical-tabs" class="vertical-tabs hidden">
        <div class="tab-list"></div>
        <div class="tab-actions">
          <button id="new-tab-btn" title="New File">+</button>
        </div>
      </div>

      <!-- Explorer Panel (Project mode) -->
      <div id="explorer-pane" class="explorer-panel hidden">
        <div class="explorer-header">
          <span>Explorer</span>
          <div class="explorer-actions">
            <button id="new-file-btn" title="New File">+</button>
            <button id="search-btn" title="Search (Ctrl+Shift+F)">üîç</button>
            <button id="refresh-tree-btn" title="Refresh">‚ü≥</button>
          </div>
        </div>
        <!-- Search Panel -->
        <div id="search-panel" class="search-panel hidden">
          <div class="search-input-container">
            <input type="text" id="search-input" placeholder="Search in project..." />
            <button id="search-close-btn" title="Close">√ó</button>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>
        <div id="file-tree" class="file-tree"></div>
        <div id="explorer-resizer" class="resizer"></div>
      </div>

      <div id="toc-pane" class="pane">
        <div id="toc-header">
          <span>Table of Contents</span>
          <button id="btn-toc-close" title="Close TOC">&times;</button>
        </div>
        <div id="toc-content"></div>
        <div id="toc-resizer"></div>
      </div>
      <div id="editor-pane" class="pane">
        <div id="editor-toolbar">
          <button id="btn-explorer-toggle" title="Explorer (Ctrl+E)" class="hidden">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
          </button>
          <button id="btn-toc-toggle" title="Table of Contents (ÁõÆÊ¨°)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="15" y2="12"></line>
              <line x1="3" y1="18" x2="18" y2="18"></line>
            </svg>
          </button>
          <button id="btn-insert-image" title="Insert Image (ÁîªÂÉèÊåøÂÖ•)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <circle cx="8.5" cy="8.5" r="1.5"></circle>
              <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
          </button>
          <span class="toolbar-separator"></span>
          <span id="editor-info"></span>
        </div>
        <div id="editor-container"></div>
        <div id="vim-statusbar"></div>
      </div>
      <div id="preview-pane" class="pane">
        <div id="preview-toolbar">
          <button id="btn-fold-all" title="Fold all">‚ñº Fold</button>
          <button id="btn-unfold-all" title="Unfold all">‚ñ∂ Unfold</button>
        </div>
        <div id="preview"></div>
      </div>
    </main>

    <footer id="statusbar">
      <span id="cursor-pos">1:1</span>
      <span id="stats-info"></span>
    </footer>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Keyboard Shortcuts</h2>
          <button id="help-close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="help-section">
            <h3>File Operations</h3>
            <table>
              <tr><td><kbd>Ctrl+N</kbd></td><td>New file</td></tr>
              <tr><td><kbd>Ctrl+O</kbd></td><td>Open file</td></tr>
              <tr><td><kbd>Ctrl+S</kbd></td><td>Save file</td></tr>
              <tr><td><kbd>Ctrl+Shift+S</kbd></td><td>Save as</td></tr>
              <tr><td><kbd>Ctrl+`</kbd></td><td>Toggle VIM mode</td></tr>
            </table>
          </div>
          <div class="help-section">
            <h3>Vim Commands</h3>
            <table>
              <tr><td><kbd>:w</kbd></td><td>Save file</td></tr>
              <tr><td><kbd>:w filename</kbd></td><td>Save as filename</td></tr>
              <tr><td><kbd>:q</kbd></td><td>Quit</td></tr>
              <tr><td><kbd>:q!</kbd></td><td>Quit without saving</td></tr>
              <tr><td><kbd>:wq</kbd></td><td>Save and quit</td></tr>
              <tr><td><kbd>:e filename</kbd></td><td>Open file</td></tr>
              <tr><td><kbd>:e URL</kbd></td><td>Fetch markdown from URL</td></tr>
              <tr><td><kbd>:fetch</kbd> / <kbd>:url</kbd></td><td>Fetch markdown (prompt for URL)</td></tr>
              <tr><td><kbd>:new</kbd></td><td>New file</td></tr>
              <tr><td><kbd>:pwd</kbd></td><td>Show current directory</td></tr>
              <tr><td><kbd>:cd path</kbd></td><td>Change current directory</td></tr>
              <tr><td><kbd>:help</kbd></td><td>Show this help</td></tr>
              <tr><td><kbd>:toc</kbd></td><td>Toggle Table of Contents</td></tr>
              <tr><td><kbd>:export</kbd></td><td>Export to HTML</td></tr>
              <tr><td><kbd>:pdf</kbd></td><td>Export to PDF</td></tr>
              <tr><td><kbd>:image</kbd></td><td>Insert image from file</td></tr>
            </table>
          </div>
          <div class="help-section">
            <h3>Project Commands</h3>
            <table>
              <tr><td><kbd>:project new</kbd></td><td>Create new project</td></tr>
              <tr><td><kbd>:project open</kbd></td><td>Open project</td></tr>
              <tr><td><kbd>:project save</kbd></td><td>Save project</td></tr>
              <tr><td><kbd>:project close</kbd></td><td>Close project</td></tr>
              <tr><td><kbd>:vnew [name]</kbd></td><td>New file in project</td></tr>
              <tr><td><kbd>:vpaste [name]</kbd></td><td>New file from clipboard</td></tr>
              <tr><td><kbd>:bn / :bnext</kbd></td><td>Next buffer</td></tr>
              <tr><td><kbd>:bp / :bprev</kbd></td><td>Previous buffer</td></tr>
              <tr><td><kbd>:b [name]</kbd></td><td>Switch to buffer</td></tr>
              <tr><td><kbd>:ls / :buffers</kbd></td><td>List buffers</td></tr>
              <tr><td><kbd>:bd</kbd></td><td>Close buffer</td></tr>
              <tr><td><kbd>:Ex / :explorer</kbd></td><td>Toggle explorer</td></tr>
              <tr><td><kbd>:layout [preset]</kbd></td><td>Set layout (default, obsidian, minimal, writer, code)</td></tr>
            </table>
          </div>
          <div class="help-section">
            <h3>Image Insert</h3>
            <table>
              <tr><td><kbd>Ctrl+V</kbd></td><td>Paste image from clipboard</td></tr>
              <tr><td><kbd>Drag&Drop</kbd></td><td>Drop image file onto editor</td></tr>
              <tr><td><kbd>:image</kbd></td><td>Select image file</td></tr>
              <tr><td><kbd>üñºÔ∏è button</kbd></td><td>Select image file</td></tr>
            </table>
          </div>
          <div class="help-section">
            <h3>Import / Export</h3>
            <table>
              <tr><td><kbd>:imp</kbd></td><td>Open import dialog</td></tr>
              <tr><td><kbd>:imp [path/url]</kbd></td><td>Import file or URL</td></tr>
              <tr><td><kbd>:exp</kbd></td><td>Open export dialog</td></tr>
              <tr><td><kbd>:exp md</kbd></td><td>Export current page as MD</td></tr>
              <tr><td><kbd>:exp html</kbd></td><td>Export current page as HTML</td></tr>
              <tr><td><kbd>:exp all md</kbd></td><td>Export all pages to MD folder</td></tr>
              <tr><td><kbd>:exp all merge</kbd></td><td>Export all pages merged</td></tr>
              <tr><td><kbd>:exp all html</kbd></td><td>Export all pages as HTML</td></tr>
              <tr><td><kbd>:exp mdbook</kbd></td><td>Export as mdbook format</td></tr>
            </table>
          </div>
          <div class="help-section">
            <h3>Settings Commands</h3>
            <table>
              <tr><td><kbd>:set wrap</kbd></td><td>Enable word wrap</td></tr>
              <tr><td><kbd>:set nowrap</kbd></td><td>Disable word wrap</td></tr>
              <tr><td><kbd>:set tabsize=N</kbd></td><td>Set tab size</td></tr>
              <tr><td><kbd>:set fontsize=N</kbd></td><td>Set font size %</td></tr>
              <tr><td><kbd>:set number</kbd></td><td>Show line numbers</td></tr>
              <tr><td><kbd>:set nonumber</kbd></td><td>Hide line numbers</td></tr>
              <tr><td><kbd>:set minimap</kbd></td><td>Show minimap</td></tr>
              <tr><td><kbd>:set autosave</kbd></td><td>Enable auto-save</td></tr>
              <tr><td><kbd>:set noautosave</kbd></td><td>Disable auto-save</td></tr>
              <tr><td><kbd>:theme dark</kbd></td><td>Dark theme</td></tr>
              <tr><td><kbd>:theme light</kbd></td><td>Light theme</td></tr>
            </table>
          </div>
          <div class="help-section">
            <h3>Vim Modes</h3>
            <table>
              <tr><td><kbd>i</kbd></td><td>Insert mode</td></tr>
              <tr><td><kbd>v</kbd></td><td>Visual mode</td></tr>
              <tr><td><kbd>V</kbd></td><td>Visual line mode</td></tr>
              <tr><td><kbd>Esc</kbd></td><td>Normal mode</td></tr>
            </table>
          </div>
          <div class="help-section">
            <h3>Markdown Extensions</h3>
            <table>
              <tr><td><kbd>- [x]</kbd></td><td>Checkbox (checked)</td></tr>
              <tr><td><kbd>- [ ]</kbd></td><td>Checkbox (unchecked)</td></tr>
              <tr><td><kbd>:::note info</kbd></td><td>Info note (Qiita)</td></tr>
              <tr><td><kbd>:::note warn</kbd></td><td>Warning note (Qiita)</td></tr>
              <tr><td><kbd>:::note alert</kbd></td><td>Alert note (Qiita)</td></tr>
              <tr><td><kbd>&gt; [!NOTE]</kbd></td><td>Note (GitHub)</td></tr>
              <tr><td><kbd>&gt; [!WARNING]</kbd></td><td>Warning (GitHub)</td></tr>
              <tr><td><kbd>ÔΩúÊº¢Â≠ó„Ää„Åã„Çì„Åò„Äã</kbd></td><td>Ruby (furigana)</td></tr>
              <tr><td><kbd>[^1]</kbd></td><td>Footnote reference</td></tr>
              <tr><td><kbd>[^1]: text</kbd></td><td>Footnote definition</td></tr>
              <tr><td><kbd>$E=mc^2$</kbd></td><td>Inline math (KaTeX)</td></tr>
              <tr><td><kbd>$$...$$</kbd></td><td>Block math (KaTeX)</td></tr>
            </table>
          </div>
          <div class="help-section">
            <h3>Drag &amp; Drop</h3>
            <table>
              <tr><td>Image files</td><td>Insert as embedded image</td></tr>
              <tr><td>.md / .txt files</td><td>Open file</td></tr>
              <tr><td>.mdvim files</td><td>Open with images</td></tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Export Modal -->
    <div id="export-modal" class="modal hidden">
      <div class="modal-content export-modal-content">
        <div class="modal-header">
          <h2>Export</h2>
          <button id="export-close-btn" class="modal-close">&times;</button>
        </div>
        <div class="export-options">
          <div class="export-section">
            <label class="export-label">Scope</label>
            <div class="export-radio-group">
              <label><input type="radio" name="export-scope" value="current" checked> Current Page</label>
              <label><input type="radio" name="export-scope" value="all"> All Pages</label>
            </div>
          </div>
          
          <div class="export-section">
            <label class="export-label">Format</label>
            <select id="export-format">
              <option value="md">Markdown (images as files)</option>
              <option value="md-inline">Markdown (images inline)</option>
              <option value="md-merged">Markdown (merged)</option>
              <option value="html">HTML (single page)</option>
              <option value="html-multi">HTML (multi-page site)</option>
              <option value="mdbook">mdbook format</option>
              <option value="pdf">PDF</option>
            </select>
          </div>
          
          <div class="export-section">
            <label class="export-label">Options</label>
            <div class="export-checkbox-group">
              <label><input type="checkbox" id="export-include-images" checked> Include images</label>
              <label><input type="checkbox" id="export-include-toc"> Include table of contents</label>
              <label><input type="checkbox" id="export-number-headings"> Number headings</label>
            </div>
          </div>
          
          <div class="export-actions">
            <button id="export-cancel-btn" class="btn-secondary">Cancel</button>
            <button id="export-execute-btn" class="btn-primary">Export</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Progress Modal -->
    <div id="progress-modal" class="modal hidden">
      <div class="modal-content progress-modal-content">
        <div class="progress-header">
          <span id="progress-title">Processing...</span>
        </div>
        <div class="progress-body">
          <div class="progress-bar-container">
            <div id="progress-bar" class="progress-bar"></div>
          </div>
          <div id="progress-text" class="progress-text">0%</div>
          <div id="progress-detail" class="progress-detail"></div>
        </div>
      </div>
    </div>
    
    <!-- New File Modal -->
    <div id="newfile-modal" class="modal hidden">
      <div class="modal-content newfile-modal-content">
        <div class="modal-header">
          <h2>New File</h2>
          <button id="newfile-close-btn" class="modal-close">&times;</button>
        </div>
        <div class="newfile-body">
          <label for="newfile-name">File name:</label>
          <input type="text" id="newfile-name" value="untitled.md" />
        </div>
        <div class="newfile-actions">
          <button id="newfile-ok-btn" class="btn-primary">OK</button>
          <button id="newfile-clipboard-btn" class="btn-secondary btn-small-text" title="Create with clipboard content">Paste &amp; Create</button>
          <button id="newfile-cancel-btn" class="btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
